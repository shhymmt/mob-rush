# レーンランナーメカニクス計画

**作成日:** 2025-01-17
**ステータス:** ドラフト

## 概要

### 私が本当に作りたいもの

Phase 6を完了した後、作ったゲームが自分のイメージと違うことに気づいた。Mob Controlをクローンしようとしていたが、それは私が作りたいゲームではない。

私が本当に作りたいのは：
- 敵が私に向かってスクロールしてくるレーンベースのランナー
- 私のユニットが自動で弾を撃って敵を倒す
- 良いゲートを取り、悪いゲートを避けるためにレーン間を移動する

これはMob Controlのキャノン照準メカニクスとは根本的に異なる。

---

## なぜこの再設計が必要か

### 問題

Phase 6ではMob Controlのメカニクスを実装した：
- ドラッグでキャノンを照準
- ユニットが1対1で相殺
- 固定カメラ

でも参考画像を見直すと、私が欲しいのは：
- タップでレーンを切り替え
- ユニットが弾を撃って敵のHPを削る
- 敵/ゲートが下にスクロールしてくる

### 私の参考画像（IMG_2381.jpg）

画像から読み取れること：
- 2レーン、敵が下にスクロール
- 青いユニットが下部で上に向かって弾を発射
- 左にボス、HP: 1338
- -10ゲート（ユニットを減らす）
- 弾が敵に当たると爆発エフェクト

これが私が作りたいゲームだ。

---

## 目標ゲームデザイン

```
      ← スクロール方向（敵/ゲートが下に移動）

      レーン1          レーン2
         │               │
         ▼               ▼
       [+10]           [-5]      ← ゲートが下に流れてくる
         │               │
         ▼               ▼
      [敵              [敵
       HP:50]          HP:30]    ← 敵が下に流れてくる
         │               │
         │      ↑        │
         │     弾        │        ← 私のユニットが自動で弾を発射
         │               │
   ┌─────────────────────────┐
   │   [私のユニット x3]      │    ← タップでレーン移動
   └─────────────────────────┘
```

### 私の仕様

| 要素 | 私が欲しいもの |
|------|----------------|
| レーン数 | 2（最初はシンプルに） |
| 初期ユニット数 | 3 |
| スクロール | 敵/ゲートが私に向かって下に移動 |
| ユニット移動 | 私のユニットは全員一緒に移動 |
| 射撃 | 移動していない時に自動発射、移動中は停止 |
| 操作（モバイル） | レーンをタップで移動 |
| 操作（PC） | レーンをクリックで移動 |
| ダメージ | 私のユニット数 × 1ダメージ/発射 |
| ゲート種類 | +N（加算）、-N（減算）、xN（乗算） |
| 敵 | HPあり、弾でダメージ |
| ゲームオーバー | ユニット数0 または 敵と衝突 |
| スクロール速度 | ステージレベルで調整（Stage 1 = チュートリアル） |

---

## Phase 6から再利用できるもの

| コンポーネント | 判断 | 理由 |
|---------------|------|------|
| Object Pooling | **再利用** | 弾、敵に使える |
| Health.cs | **再利用** | 敵のHPシステムはそのまま使える |
| GameManager | **変更** | 新しい勝敗条件に対応 |
| Gate.cs | **変更** | 減算ゲート追加、トリガーロジック変更 |
| Unit.cs | **置き換え** | 完全に異なる動作になる |
| Enemy.cs | **置き換え** | HPあり、スクロールする |
| InputHandler.cs | **置き換え** | レーンベース入力に変更 |
| UnitSpawner.cs | **置き換え** | 連続スポーンは不要 |
| EnemySpawner.cs | **変更** | レーンベーススポーン+スクロール |

### 新しく必要なコンポーネント

| コンポーネント | 目的 |
|---------------|------|
| LaneManager.cs | 2レーン管理、ユニット位置 |
| Bullet.cs | 私のユニットが発射する弾 |
| BulletSpawner.cs | 弾のプーリングと発射 |
| ScrollManager.cs | スクロール速度制御 |
| LaneInputHandler.cs | レーンタップ/クリック検出 |

---

## 実装ステップ

### Phase 7A: レーンシステム基盤

1. [ ] LaneManager作成（2レーン）
2. [ ] レーンの視覚的インジケータ作成
3. [ ] LaneInputHandler実装（タップ/クリック検出）
4. [ ] レーン間を移動するユニットグループ作成
5. [ ] **テスト**: タップ/クリックでユニットがレーン移動

### Phase 7B: スクロールシステム

1. [ ] ScrollManager作成（スクロール速度制御）
2. [ ] オブジェクトスクロール実装（時間経過で下に移動）
3. [ ] 画面外検出とリサイクル追加
4. [ ] スクロール速度パラメータ設定
5. [ ] **テスト**: オブジェクトが下にスクロールして消える

### Phase 7C: 弾システム

1. [ ] Bullet.cs作成（上に移動、ダメージを与える）
2. [ ] BulletSpawnerをオブジェクトプーリングで作成
3. [ ] 自動発射ロジック実装（移動していない時に発射）
4. [ ] 発射レート = X秒ごとに1発射
5. [ ] ダメージ = ユニット数 × 1
6. [ ] **テスト**: ユニットが弾を発射、弾が上に移動

### Phase 7D: 敵システム再設計

1. [ ] Enemy.csをHP制に変更（Healthコンポーネント使用）
2. [ ] 敵が弾からダメージを受ける
3. [ ] 敵がScrollManagerでスクロール
4. [ ] ユニットとの衝突検出 = ゲームオーバー
5. [ ] HP0で敵破壊
6. [ ] **テスト**: 弾が敵にダメージ、敵が下にスクロール

### Phase 7E: ゲートシステム再設計

1. [ ] Gate.csをレーンベース配置に変更
2. [ ] 減算ゲートタイプ（-N）追加
3. [ ] ゲートがScrollManagerでスクロール
4. [ ] 同レーンのユニット衝突でトリガー
5. [ ] **テスト**: ゲートがユニットを加算/減算/乗算

### Phase 7F: ゲームループ更新

1. [ ] GameManagerを新ゲームオーバー条件に更新
2. [ ] ユニット数0 → ゲームオーバー
3. [ ] 敵と衝突 → ゲームオーバー
4. [ ] ステージクリア条件（終点到達 or 全敵撃破）
5. [ ] UIを新ゲーム状態に更新
6. [ ] **テスト**: 勝利・敗北条件が動作

### Phase 7G: ステージシステム

1. [ ] ステージ設定作成（スクロール速度、敵パターン）
2. [ ] Stage 1 = チュートリアル（遅い、シンプル）
3. [ ] 段階的な難易度上昇
4. [ ] **テスト**: 複数ステージがプレイ可能

---

## 私の懸念点

### パフォーマンス

- 画面に大量の弾が出る → プーリング必須
- 敵/ゲートのリサイクル（スクロールで画面外に出たら）
- 弾の衝突判定が重くなるかも

### うまくいかない可能性

- レーン切り替えがもっさりするかも
- 弾の発射レートが難しすぎ/簡単すぎになるかも
- スクロール速度のバランス調整は試行錯誤が必要

---

## テスト計画

| テスト | 私がやること | 期待結果 |
|--------|-------------|----------|
| レーン切り替え | 別のレーンをタップ | 私のユニットがそこに移動 |
| 射撃 | 移動後に待機 | 弾が自動発射される |
| 移動中は射撃停止 | レーンをタップ | 移動中は射撃が止まる |
| 敵へのダメージ | 弾を敵に当てる | 敵のHPが減る |
| 敵の死亡 | HPを0にする | 敵が消える |
| ゲート+N | +10ゲートを通過 | 私のユニット数: 3 → 13 |
| ゲート-N | -5ゲートを通過 | 私のユニット数: 13 → 8 |
| ゲームオーバー（衝突） | 敵に当たる | ゲームオーバー画面 |
| ゲームオーバー（ユニット0） | -Nで0になるまで | ゲームオーバー画面 |

---

## 完了の定義

- [ ] 2レーンでタップ/クリック切り替え
- [ ] 私のユニットが静止時に自動で弾を発射
- [ ] 敵が下にスクロールし弾でダメージを受ける
- [ ] ゲート（+N, -N, xN）が私のユニット数に影響
- [ ] 衝突またはユニット数0でゲームオーバー
- [ ] Stage 1（チュートリアル）がプレイ可能
- [ ] 私の参考画像のようなゲームになる

---

## メモ

- これは小さな修正ではなく、大きな再設計
- Phase 6のコードは一部再利用できるが、ほとんど変わる
- まずコアメカニクスに集中、ポリッシュは後
- うまくいかなければ繰り返し修正する

---

*計画作成日: 2025-01-17*
*ステータス: 承認待ち*
